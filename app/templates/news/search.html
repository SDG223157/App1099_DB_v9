{% extends "base.html" %}

{% block title %}News Search{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/news.css') }}">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Search Form -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h1 class="text-2xl font-bold mb-6">News Search</h1>
        <form id="searchForm" method="GET" action="{{ url_for('news.search') }}" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Keyword Search -->
                <div>
                    <label for="keyword" class="block text-sm font-medium text-gray-700">Keyword</label>
                    <input type="text" name="keyword" id="keyword" 
                           value="{{ search_params.keyword }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Symbol Search -->
                <div>
                    <label for="symbol" class="block text-sm font-medium text-gray-700">Symbol</label>
                    <input type="text" name="symbol" id="symbol" 
                           value="{{ search_params.symbol }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Sentiment Filter -->
                <div>
                    <label for="sentiment" class="block text-sm font-medium text-gray-700">Sentiment</label>
                    <select name="sentiment" id="sentiment" 
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">All</option>
                        <option value="POSITIVE" {% if search_params.sentiment == 'POSITIVE' %}selected{% endif %}>Positive</option>
                        <option value="NEUTRAL" {% if search_params.sentiment == 'NEUTRAL' %}selected{% endif %}>Neutral</option>
                        <option value="NEGATIVE" {% if search_params.sentiment == 'NEGATIVE' %}selected{% endif %}>Negative</option>
                    </select>
                </div>

                <!-- Date Range -->
                <div>
                    <label for="start_date" class="block text-sm font-medium text-gray-700">Start Date</label>
                    <input type="date" name="start_date" id="start_date" 
                           value="{{ search_params.start_date }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <div>
                    <label for="end_date" class="block text-sm font-medium text-gray-700">End Date</label>
                    <input type="date" name="end_date" id="end_date" 
                           value="{{ search_params.end_date }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button type="reset" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                    Reset
                </button>
                <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                    Search
                </button>
            </div>
        </form>
    </div>

    <!-- Search Results -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">Search Results</h2>
            <span class="text-gray-600">{{ total }} articles found</span>
        </div>

        <!-- Results List -->
        <div id="searchResults" class="space-y-6">
            {% for article in articles %}
            <div class="border-b border-gray-200 pb-4 last:border-b-0">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-medium">
                        <a href="{{ article.url }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                            {{ article.title }}
                        </a>
                    </h3>
                    <span class="text-sm text-gray-500">{{ article.published_at }}</span>
                </div>
                
                <!-- Article Summary -->
                <div class="mb-2">
                    <p class="text-gray-600">{{ article.summary.brief }}</p>
                </div>

                <!-- Key Points -->
                {% if article.summary.key_points %}
                <div class="mb-2">
                    <h4 class="text-sm font-semibold text-gray-700">Key Points:</h4>
                    <p class="text-sm text-gray-600">{{ article.summary.key_points }}</p>
                </div>
                {% endif %}

                <!-- Market Impact -->
                {% if article.summary.market_impact %}
                <div class="mb-2">
                    <h4 class="text-sm font-semibold text-gray-700">Market Impact:</h4>
                    <p class="text-sm text-gray-600">{{ article.summary.market_impact }}</p>
                </div>
                {% endif %}

                <!-- Tags and Metadata -->
                <div class="flex flex-wrap gap-2">
                    {% for symbol in article.symbols %}
                    <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-sm">{{ symbol }}</span>
                    {% endfor %}
                    
                    <span class="bg-{{ article.sentiment.overall_sentiment|lower }}-100 text-{{ article.sentiment.overall_sentiment|lower }}-700 px-2 py-1 rounded text-sm">
                        {{ article.sentiment.overall_sentiment|title }}
                        ({{ "%.1f"|format(article.sentiment.confidence * 100) }}%)
                    </span>
                    
                    <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-sm">
                        {{ article.source }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total > search_params.per_page %}
        <div class="mt-6">
            <nav class="flex items-center justify-between">
                <div class="flex-1 flex justify-between sm:hidden">
                    {% if search_params.page > 1 %}
                    <a href="{{ url_for('news.search', page=search_params.page-1, **search_params) }}" 
                       class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        Previous
                    </a>
                    {% endif %}
                    
                    {% if total > search_params.page * search_params.per_page %}
                    <a href="{{ url_for('news.search', page=search_params.page+1, **search_params) }}"
                       class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        Next
                    </a>
                    {% endif %}
                </div>
                
                <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                    <div>
                        <p class="text-sm text-gray-700">
                            Showing
                            <span class="font-medium">{{ (search_params.page - 1) * search_params.per_page + 1 }}</span>
                            to
                            <span class="font-medium">{{ min(search_params.page * search_params.per_page, total) }}</span>
                            of
                            <span class="font-medium">{{ total }}</span>
                            results
                        </p>
                    </div>
                </div>
            </nav>